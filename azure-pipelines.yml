trigger:
- main

pool:
  name: Default  # ğŸ‘ˆ Your self-hosted agent pool

steps:
- checkout: self

- script: |
    echo "ğŸ“„ Copying latest app.py to /home/vamsi/app..."
    mkdir -p /home/vamsi/app
    cp $(Build.SourcesDirectory)/app.py /home/vamsi/app/

    echo "ğŸ”„ Reloading systemd daemon and restarting Flask service..."
    sudo systemctl daemon-reload
    sudo systemctl restart flaskapp

    echo "âŒ› Waiting 5 seconds for Flask to start..."
    sleep 5

    echo "ğŸŒ Checking public IP response on port 8080..."
    curl http://20.235.171.134:8080 || echo "âŒ App is not responding"
  displayName: 'Deploy Flask App via systemd'
