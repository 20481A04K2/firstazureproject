trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: DeployToVM
  jobs:
  - job: CopyAndDeploy
    steps:
    - checkout: self

    - task: CopyFilesOverSSH@0
      inputs:
        sshEndpoint: 'vm-password-ssh-connection'  # ðŸ”§ Must exist in DevOps
        sourceFolder: '$(Build.SourcesDirectory)'
        contents: '**'
        targetFolder: '/home/vamsi/app'

    - task: SSH@0
      inputs:
        sshEndpoint: 'vm-password-ssh-connection'
        runOptions: 'inline'
        inline: |
          cd /home/vamsi/app
          chmod +x deploy.sh
          ./deploy.sh
